#!/bin/sh
#######################
#  create a list of depend files of g++
#$Id: cxxdepends,v 1.8 2009-11-03 10:30:44 fujiik Exp $
#######################


UNAME=`uname`

echocmd=`which echo`
cxx=gcc
iret=`which $cxx | grep -c /`
if [ $iret != 0 ]; then
  gccverno=`$cxx -v 2>&1 | tail -1 | sed -e 's;.* \([0-9]*\.[0-9]*\.*[0-9]*\) .*;\1;'`
  gccmajver=`$echocmd $gccverno | cut -d. -f1`
  if [ $gccmajver != 4 ]; then
    gccvers=`$cxx -v 2>&1 | head -1 | sed -e 's;[^/]*\(/.*\)/specs.*;\1;'`
    cppfile=$gccvers/cc1
  else
    prefix=`$cxx -v 2>&1 | grep 'prefix=' | sed -e 's;.*--prefix=\([^ ]*\).*;\1;'`
    osvers=`$cxx -v 2>&1 | grep Target: | sed -e 's;.*Target: *;;'`
    gccvers=$prefix/libexec/gcc/$osvers/$gccverno
    cppfile=$gccvers/cc1
  fi
  if [ $UNAME == "CYGWIN_NT-5.0" ]; then
    cppfile=$gccvers/cc1plus.exe
  fi
  if [ ! -e $cppfile ]; then
    cppfiled=$gccvers/cpp
    if [ -e $cppfiled ]; then
      cppfile=$cppfiled
    else
      cppfiled=`$echocmd $cppfile | sed -e 's;/lib/;/libexec/;'`
      if [ -e $cppfiled ]; then
        cppfile=$cppfiled
      else
        cppfile=`$echocmd $cppfile | sed -e 's;/libexec/;/lib64/;'`
      fi
    fi
  fi

  strcmd=`which strings`
  incdir=`$strcmd $cppfile  | grep include  | grep "/" | uniq `
  usrinclude=/usr/include
  for i  in `$echocmd ${incdir}`
  do
    if [ -d $i -a "$i" != "/usr/include" ]; then
	$echocmd -n " -I$i" 
    fi
  done
fi
exit 0
